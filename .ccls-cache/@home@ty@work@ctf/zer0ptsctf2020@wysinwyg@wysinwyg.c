//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2020 Retargetable Decompiler <info@retdec.com>
//

#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <unistd.h>

// ---------------- Integer Types Definitions -----------------

typedef int64_t int128_t;

// ------------------- Function Prototypes --------------------

int64_t entry_point(int64_t a1, int64_t a2, int64_t a3, int64_t a4);
int64_t function_5d0(void);
int32_t function_600(char * s);
void function_610(void);
int32_t function_620(int32_t sysno, ...);
int32_t function_630(int64_t request, ...);
void function_640(int64_t * d);
int64_t function_680(void);
int64_t function_6c0(void);
int64_t function_710(void);
int64_t function_750(void);
int64_t function_75a(int64_t a1, int64_t a2, int64_t a3);
int64_t function_7e1(int64_t a1, int64_t * a2);
int64_t function_932(void);
int64_t function_b05(int64_t a1, int64_t a2);
int64_t function_b50(int64_t a1, int64_t a2, int64_t a3);
int64_t function_bc0(void);
int64_t function_bc4(void);

// --------------------- Global Variables ---------------------

int64_t g1 = 1872;
int64_t g2 = 1808;
int64_t g3 = 0x1a400138;
int64_t g4 = 0;
int32_t g5 = 0;
int32_t g6 = 0;
int64_t g7 = 0; // rbp
int32_t g8;
int128_t g9 = 0; // xmm0

// ------------------------ Functions -------------------------

// Address range: 0x5d0 - 0x5e7
int64_t function_5d0(void) {
    // 0x5d0
    int64_t result;
    if (*(int64_t *)0x201fe8 != 0) {
        // 0x5e0
        __gmon_start__();
        result = &g8;
    } else {
        result = 0;
    }
    // 0x5e2
    return result;
}

// Address range: 0x600 - 0x606
int32_t function_600(char * s) {
    // 0x600
    return puts(s);
}

// Address range: 0x610 - 0x616
void function_610(void) {
    // 0x610
    __stack_chk_fail();
}

// Address range: 0x620 - 0x626
int32_t function_620(int32_t sysno, ...) {
    // 0x620
    return syscall(sysno);
}

// Address range: 0x630 - 0x636
int32_t function_630(int64_t request, ...) {
    // 0x630
    return ptrace(request);
}

// Address range: 0x640 - 0x646
void function_640(int64_t * d) {
    // 0x640
    __cxa_finalize(d);
}

// Address range: 0x650 - 0x67b
int64_t entry_point(int64_t a1, int64_t a2, int64_t a3, int64_t a4) {
    // 0x650
    int64_t v1;
    __libc_start_main(2821, (int32_t)a4, (char **)&v1, (void (*)())2896, (void (*)())3008, (void (*)())a3);
    __asm_hlt();
    // UNREACHABLE
}

// Address range: 0x680 - 0x6b2
int64_t function_680(void) {
    // 0x680
    return &g4;
}

// Address range: 0x6c0 - 0x702
int64_t function_6c0(void) {
    // 0x700
    return 0;
}

// Address range: 0x710 - 0x74a
int64_t function_710(void) {
    // 0x710
    if (*(char *)&g4 != 0) {
        // 0x748
        int64_t result; // rax
        return result;
    }
    if (*(int64_t *)0x201ff8 != 0) {
        // 0x727
        __cxa_finalize((int64_t *)*(int64_t *)0x202008);
    }
    int64_t result2 = function_680(); // bp+733
    *(char *)&g4 = 1;
    return result2;
}

// Address range: 0x750 - 0x75a
int64_t function_750(void) {
    // 0x750
    return function_6c0();
}

// Address range: 0x75a - 0x7e1
int64_t function_75a(int64_t a1, int64_t a2, int64_t a3) {
    int64_t v1 = g7;
    int64_t v2 = v1; // bp-8
    g7 = &v2;
    if (a1 == 0) {
        // 0x7df
        g7 = v1;
        return 0;
    }
    int64_t result;
    if (a2 != 0) {
        // 0x78a
        function_75a(a1, a2 - 1, a3);
        result = 0;
    } else {
        v2 = v1;
        result = 1;
    }
    // 0x7df
    g7 = v2;
    return result;
}

// Address range: 0x7e1 - 0x932
int64_t function_7e1(int64_t a1, int64_t * a2) {
    int64_t v1 = (int64_t)a2;
    uint64_t v2 = *(int64_t *)(v1 + 120);
    if (v2 == 5) {
        // 0x826
        g6 = 0;
        // 0x90a
        return syscall(SYS_ioperm);
    }
    if (v2 >= 6) {
        switch (v2) {
            case 12: {
                int128_t v3 = __asm_pxor(g9, g9); // bp+835
                g9 = v3;
                g5 = __asm_movss(v3);
                // 0x90a
                return syscall(SYS_ioperm);
            }
            case 231: {
                // 0x8e5
                if (g6 == 0) {
                    // 0x8fd
                    puts("Correct!");
                } else {
                    // 0x8ef
                    puts("Wrong!");
                }
                // break -> 0x909
                break;
            }
            default: {
                // 0x90a
                return syscall(SYS_ioperm);
            }
        }
        // 0x90a
        return syscall(SYS_ioperm);
    }
    if (v2 == 1) {
        uint32_t v4 = ptrace(2); // bp+862
        *(int64_t *)(v1 + 96) = 1;
        int64_t v5 = 0x100000000000000 * (int64_t)v4 / 0x100000000000000; // bp+876
        int64_t v6 = function_75a(v5, 0x5beb, 0x8bae6fa3); // rcx
        int32_t v7 = __asm_cvttss2si(__asm_movss_1(g5)); // bp+898
        int64_t v8 = *(int64_t *)(8 * (int64_t)v7 + (int64_t)&g3);
        g6 |= (int32_t)(v6 - v8);
        int128_t v9 = __asm_movss_1(g5);
        int128_t v10 = __asm_addss(__asm_movss_1(*(int32_t *)3060), v9);
        g9 = v10;
        g5 = __asm_movss(v10);
    }
    // 0x90a
    return syscall(SYS_ioperm);
}

// Address range: 0x932 - 0xb05
int64_t function_932(void) {
    int64_t v1 = __readfsqword(40);
    uint32_t v2 = syscall(SYS_setpgid); // bp+956
    if (v2 != 0) {
        // 0x9cd
        syscall(SYS_chroot);
        syscall(SYS_ioperm);
        while (true) {
            // 0xa21
            syscall(SYS_ioperm);
            syscall(SYS_chroot);
            int32_t v3; // bp-384
            if (v3 == 127) {
                if ((int16_t)v3 <= 0xffff) {
                    // 0xa92
                    syscall(SYS_ioperm);
                    int64_t v4; // bp-232
                    function_7e1((int64_t)v2, &v4);
                }
            }
            if (v3 % 128 == 0) {
                // 0xae5
                syscall(SYS_fgetxattr);
            }
        }
    }
    // 0x96a
    syscall(SYS_ioperm);
    syscall(SYS_mkdir);
    syscall(SYS_ustat);
    int64_t result;
    if (__readfsqword(40) != v1) {
        // 0xafe
        __stack_chk_fail();
        result = &g8;
    } else {
        result = 0;
    }
    // 0xb03
    return result;
}

// Address range: 0xb05 - 0xb42
int64_t function_b05(int64_t a1, int64_t a2) {
    // 0xb05
    if ((int32_t)a1 != 2) {
        // 0xb2f
        puts("Feed me flag");
    } else {
        // 0xb1a
        puts((char *)*(int64_t *)(a2 + 8));
    }
    // 0xb3b
    return 0;
}

// Address range: 0xb50 - 0xbb5
int64_t function_b50(int64_t a1, int64_t a2, int64_t a3) {
    int64_t result = function_5d0();
    if ((int64_t)&g2 - (int64_t)&g1 >> 3 != 0) {
        int64_t v1 = 0; // 0xb9d2
        while (v1 != ((int64_t)&g2 - (int64_t)&g1 >> 3) - 1) {
            // 0xb90
            v1++;
        }
    }
    // 0xba6
    return result;
}

// Address range: 0xbc0 - 0xbc2
int64_t function_bc0(void) {
    // 0xbc0
    int64_t result; // rax
    return result;
}

// Address range: 0xbc4 - 0xbcd
int64_t function_bc4(void) {
    // 0xbc4
    int64_t result; // rax
    return result;
}

// --------------- Dynamically Linked Functions ---------------

// void __cxa_finalize(void * d);
// void __gmon_start__(void);
// int __libc_start_main(int *(main)(int, char **, char **), int argc, char ** ubp_av, void(* init)(void), void(* fini)(void), void(* rtld_fini)(void), void(* stack_end));
// void __stack_chk_fail(void);
// long int ptrace(enum __ptracerequest __request, ...);
// int puts(const char * s);
// long int syscall(long int sysno, ...);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: gcc (7.4.0)
// Detected functions: 18
// Decompilation date: 2020-03-08 18:18:12
